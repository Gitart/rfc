# Формат приемо-передачи данных `sale-in|out` для PharmXplorer (Draft) #

Искомый формат предполагает возможность передачи данных о [приходах/расходах/остатках][0] из одной или нескольких точек за определенный временной интервал. Формат обеспечивает требования текущей архитектуры обработки данных. Пары ключ-значение, для которых не существует значения (0 для чисел или пустые строки) должны быть исключены при формировании реальных выходных данных.

Спецификация-пример (1 точка, 1 наименование):

* Формат [JSON](http://json.org/json-ru.html)
* Кодировка [UTF-8](http://ru.wikipedia.org/wiki/UTF-8)
* `//` - это комментарий только для пояснения и он должен отсутствовать в реальных данных
* `[*]` - эту пару ключ-значение можно пропустить
* `[+]` - эту пару ключ-значение вносит сервис распознавания и ее не надо формировать на передающей стороне
* `string, int, float, bool` - типы данных: “строка в двойных кавычках”, целое, число с плавающей точкой (разделитель точка “.”), логический (true|false)
* [`string[proc]`][0]
* `string[timestamp]` - дата и время строкой в формате"dd.mm.yyyy hh:mm:ss"

```json
{
	// Метаданные
	"Meta": {
		// Версия формата, int
		"Version": 1,
		// Отправитель (public key), string
		"Sender": "f96b5d3726906aeb99fb6b2bc37f91a519cbc767",
		// Агент передачи данных (программа) [*], string
		"Agent": "My Cool Application",
		// Содержимое согласно проекта, string[proc]
		"Process": "sale-out.daily",
		// Время создания этого пакета данных, string[timestamp]
		"Timestamp": "08.10.2012 00:00:00.000000",
		// Нижняя граница временного диапазона отбора данных, string[timestamp]
		"TRangeLower": "08.10.2012 00:00:00",
		// Верхняя граница временного диапазона отбора данных, string[timestamp]
		"TRangeUpper": "08.10.2012 23:59:59",
		// Остаток на начало или конец периода [*], string[lower|upper]
		"BalanceKind": "upper",
		// Учетность данных [*], string[analytic|synthetic]
		"AccountType": "analytic"
	},
	// Данные (массив заголовок/содержание)
	"Data": [{
		// Заголовок
		"Head": {
			// Источник данных (BR_NICK), string[20]
			"Source": "21-00-0540-А"
		},
		// Содержание (массив записей содержания)
		"Item": [{
			// Код препарата клиента, string[40]
			"Code": "10420",
			// Name: Полное наименование препарата + производитель (через пробел), string[255]
			"Name": "Авамис аэр.27,5мкг/доза бал. 30д Глаксо Велком",
			

			// << sale-in must
			// Поставщик, string[1024]
			"Supplier": "Рога и Копыта Корпорейшн",
			// ЕГРПОУ (ранее ОКПО), string[12]
			"EGRPOU": "82389009",
			// >>


			// << sale-in must, sale-out maybe
			// Количество прихода float
			"QuantInp": 20,
			// Цена прихода (за единицу товара, float
			"PriceInp": 32.50,
			// >>
			

			// << sale-out must
			// Количество расхода float
			"QuantOut": 3,
			// Цена расхода (за единицу товара), float
			"PriceOut": 39.72,
			// >>


			// << sale-in maybe, sale-out maybe
			// Остаток на конец периода, float
			"Balance": 8,
			// >>


			// << recognition only
			// Связь Морион для наименования [+]
			"LinkName": "FIXME",
			// Связь Морион для поставщика [+]
			"LinkSupp": "FIXME"
			// >>
		}]
	}]
}
```

[0]: https://github.com/pharmbase/rfc/blob/master/src/api-proc.md
