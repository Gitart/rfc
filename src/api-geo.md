# Morion GEO Services API (Draft) #

*This document is a work in progress. The API is not stable.*

## Соглашения ##

1. Протокол передачи данных [HTTPS](http://ru.wikipedia.org/wiki/HTTPS).

2. Формат приема-передачи данных [JSON](http://json.org/).

3. Коды состояния [стандартные](http://en.wikipedia.org/wiki/List_of_HTTP_status_codes) и возвращаются всегда. Клиент имеет право на их интерпретацию. Ошибки могут быть дополнительно подробно описаны в теле ответа запроса.

## Аутентификация ##

Аутентификация основана на хешировании пары уникальных строковых ключей "public key" и "secret key", которые однозначно идентифицируют источник передачи данных и вручаются ему перед работой с сервисом. 

По умолчанию "public key" = `sysdba`, а "secret key" = `masterkey`, следовательно при `sha1(sysdbamasterkey)` параметры для аутентификации будут записаны так:
  
  ```
  <auth> => key=sysdba&sum=f96b5d3726906aeb99fb6b2bc37f91a519cbc767
  ```

## Методы ##

API реализуется двумя методами HTTP: `GET` - для получения данных из сервиса в теле ответа на запрос и `POST` - для передачи данных в сервис в теле запроса.

### `/brand/get` - бренды (что?)

Получение списка названий брендов по введенным начальным символам (более одного). 

```
GET https://example.com/brand/get?key="value"&sum="value"&name="value" HTTP/1.1
```

Результат отсортирован по названию в алфавитном порядке. Каждый бренд содержит список его лекарственных форм, которые получаются отдельным запросом (см. ниже)

```json
[
	{
		// Уникальный иденификатор
		"Code": "f96b5d372f91a519cbc7676906aeb99fb6b2bc37",
		// Название бренда (товара)
		"Name": "АНАЛЬГИН"
	},
	{
		"Code": "cbc7676906aeb99f96b5d372f91a519fb6b2bc37",
		"Name": "АНАЛЬГИН ДЛЯ ДЕТЕЙ"
	},
	{
		"Code": "9f96b5d372f91cbc7676906aeb9a519fb6b2bc37",
		"Name": "АНАЛЬГИН-ДАРНИЦА"
	},
	...
]
```

### `/dform/get` - лекформы (что конкретно?)

Получение списка названий лекарственных форм (товара) по коду или по названию бренда. 

```
GET https://example.com/dform/get?key="value"&sum="value"&code_or_name="value" HTTP/1.1
```

Результат отсортирован по названию + форме выпуска +  значению количества действующего вещества + номеру в упаковке + производителю. Каждая лекарственная форма может продаваться в нескольких аптеках, список которых получается отдельным запросом (см. ниже)

```json
[
	{
		// Уникальный иденификатор
		"Code": "9a59f96b5d372f91cbc7676906aeb19fb6b2bc37",
		// Название лекарственной формы (товара)
		"Name": "АНАЛЬГИН р-р д/ин. 25% амп. 1 мл №10 / Биолек ЗАО (Украина, Харьков)"
	},
	{
		"Code": "b906ae199a59f96b5d372f91cbc7676fb6b2bc37",
		"Name": "АНАЛЬГИН табл. 0,5 г блистер №6 / Красная Звезда ОАО (Украина, Харьков)"
	},
	{
		"Code": "7691cbc76fb6b2bc37906aeb199a59f96b5d372f",
		"Name": "АНАЛЬГИН табл. 0,5 г стрип №10 / Лубныфарм ОАО (Украина, Лубны)"
	},
	...
]
```

### `/store/get` - аптеки (где?)

Получение списка аптек по коду лекарственной формы. 

```
GET https://example.com/dform/get?key="value"&sum="value"&code="value"&latlng="value1,value2" HTTP/1.1
```

Результат ограничен по количеству в зависимости от известности местоположения пользователя:
1. неизвестно (все? вопрос...)
2. город (все в городе)
3. точные координаты (7 рядом)

Расширенная информация по аптеке может быть получена отдельным запросом (см. ниже)

```json
[
	{
		// Уникальный иденификатор
		"Code": "5d372f91cb9a59f96bc7676906aeb19fb6b2bc37",
		// Название аптеки
		"Name": "Аптека 36.6",
		// Координата Широта
		"Latitude": 80.4567,
		// Координата Долгота
		"Longitude": 67.999432,
		// Уровень (рейтинг) сервисов аптеки (пока нарисовал звездочками)
		"Level": "****",
		// Время (примерное) в пути до аптеки от точки пользователя
		"ETime": "24 мин."
		// Цена
		"Prive": "4.50 грн."
	},
	{
		"Code": "cbc5d372f917906aeb199a59f96b676fb6b2bc37",
		"Name": "Аптека Доброго Дня",
		"Latitude": 50.451267,
		"Longitude": 30.499932,
		"Level": "*****",
		"ETime": "25 мин.",
		"Prive": "18.55 грн."
	},
	{
		"Code": "06aeb199a59f96b5d91cbc7676fb6b2bc379372f",
		"Name": "Аптека Сити",
		"Latitude": 57.465127,
		"Longitude": 28.932499,
		"Level": "****",
		"ETime": "54 мин.",
		"Prive": "104.00 грн."
	},
	...
]
```

### `/store/get` - аптеки (где?)

Получение расширенной информации об искомой аптеке по ее коду.

```
GET https://example.com/dform/get?key="value"&sum="value"&code="value" HTTP/1.1
```

Результат все доступные данные по аптеке.


```json
{
	// Код торговой точки
	"Code": "7676906aeb99fb6b2bc37f96b5d372f91a519cbc",
	// Код торговой сети
	"CodeNet": "f96b5d372f91a519cbc7676906aeb99fb6b2bc37",
	// Название торговой точки *
	"Name": "Аптека №8",
	// Тип торговой точки *
	"Kind": "Аптека",
	// Населенный пункт *
	"City": "Киев",
	// Почтовый индекс *
	"Post": "01054",
	// Адрес *
	"Addr": "ул.Воровского, 27",
	// Координата Широта *
	"Latitude": 50.451267,
	// Координата Долгота *
	"Longitude": 30.499932,
	// Описание режима работы торговой точки *
	// FIXME: array [day:{time1-time2}]
	"DescMode": "Пн-Пт: с 8-00 до 21-00\nСб: с 9-00 до 19-00\nВс: выходной",
	// Описание проезда
	"DescRoute": "От \"Цирка\" марш. №439 две ост.",
	// Телефон(ы) *
	"Phone": "(044)4515602",
	// Skype
	"Skype": "apteka-example",
	// Описание дисконтной программы
	"DescDisc": "Скидки владельцам дисконтных карт.",
	// Доставка/самовывоз
	"TypeDeliver": "самомывоз",
	// Бронирование/заказ
	"TypeBooking": "бронирование",
	// Описание условий доставки/самовывоза
	"DescDelivery": "самомывоз",
	// Описание условий бронипрования/заказа
	"DescBooking": "бронирование в течение 2 суток"
}

```
