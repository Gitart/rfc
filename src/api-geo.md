# Morion GEO Services API (Draft) #

*This document is a work in progress. The API is not stable.*

## Соглашения ##

1. Протокол передачи данных [HTTP](http://ru.wikipedia.org/wiki/HTTP).

2. Формат приема-передачи данных [JSON](http://json.org/).

3. Коды состояния [стандартные](http://en.wikipedia.org/wiki/List_of_HTTP_status_codes) и возвращаются всегда. Клиент имеет право на их интерпретацию. Ошибки могут быть дополнительно подробно описаны в теле ответа запроса.

4. `//`- это комментарий, а это `^` НЕ обязательные поля, значения которых можно опустить

## Аутентификация ##

Аутентификация основана на хешировании пары уникальных строковых ключей "public key" и "secret key", которые однозначно идентифицируют источник передачи данных и вручаются ему перед работой с сервисом. 

По умолчанию "public key" = `sysdba`, а "secret key" = `masterkey`, следовательно при `sha1(sysdbamasterkey)` параметры для аутентификации будут записаны так:
  
  ```
  keysum=sysdba,f96b5d3726906aeb99fb6b2bc37f91a519cbc767
  ```

## Методы ##

API реализуется двумя методами HTTP: `GET` - для получения данных из сервиса в теле ответа на запрос и `POST` - для передачи данных в сервис в теле запроса.

### `/name/get` - названия брендов (что?)

Получение списка названий брендов по введенным начальным символам (более двух). 

```
GET http://example.com/name/get?sstr=value&keysum=value1,value2 HTTP/1.1
```

Результат отсортирован по названию в алфавитном порядке. Каждый бренд содержит список его лекарственных форм, которые получаются отдельным запросом (см. ниже)

```json
[
	{
		"Code": "f96b5d372f91a519cbc7676906aeb99fb6b2bc37", // Уникальный иденификатор
		"Name": "АНАЛЬГИН"                                  // Название бренда (товара)
	},
	{
		"Code": "cbc7676906aeb99f96b5d372f91a519fb6b2bc37",
		"Name": "АНАЛЬГИН ДЛЯ ДЕТЕЙ"
	},
	{
		"Code": "9f96b5d372f91cbc7676906aeb9a519fb6b2bc37",
		"Name": "АНАЛЬГИН-ДАРНИЦА"
	},
	...
]
```

### `/drug/get` - лекформы (что конкретно?)


Получение списка названий лекарственных форм (товара) по коду бренда или по поисковой строке. 

```
GET http://example.com/drug/get?code_or_sstr=value&keysum=value1,value2 HTTP/1.1
```

Результат отсортирован по названию + форме выпуска +  значению количества действующего вещества + номеру в упаковке + производителю. Каждая лекарственная форма может продаваться в нескольких аптеках, список которых получается отдельным запросом (см. ниже)

```json
[
	{
		"Code": "9a59f96b5d372f91cbc7676906aeb19fb6b2bc37",                            // Уникальный иденификатор
		"Name": "АНАЛЬГИН р-р д/ин. 25% амп. 1 мл №10 / Биолек ЗАО (Украина, Харьков)" // Название лекарственной формы (товара)
	},
	{
		"Code": "b906ae199a59f96b5d372f91cbc7676fb6b2bc37",
		"Name": "АНАЛЬГИН табл. 0,5 г блистер №6 / Красная Звезда ОАО (Украина, Харьков)"
	},
	{
		"Code": "7691cbc76fb6b2bc37906aeb199a59f96b5d372f",
		"Name": "АНАЛЬГИН табл. 0,5 г стрип №10 / Лубныфарм ОАО (Украина, Лубны)"
	},
	...
]
```

### `/shop/get` - аптеки (где?)

Получение списка аптек по коду лекарственной формы. 

```
GET http://example.com/shop/get?code=value&latlng=value1,value2&keysum=value1,value2 HTTP/1.1
```

Результат ограничен по количеству в зависимости от известности местоположения пользователя:

1. неизвестно (все? вопрос...)

2. город (все в городе)

3. точные координаты (7 рядом)

Расширенная информация по аптеке может быть получена отдельным запросом (см. ниже)

```json
[
	{
		"Code": "5d372f91cb9a59f96bc7676906aeb19fb6b2bc37", // Уникальный иденификатор
		"Latitude": 80.4567,                                // Координата Широта
		"Longitude": 67.999432,                             // Координата Долгота
		"Level": 4,                                         // Рейтинг сервисов аптеки
		"ETime": 24,                                        // Время (примерное) в пути до аптеки от точки пользователя
		"Price": 4.50                                       // Цена
	},
	{
		"Code": "cbc5d372f917906aeb199a59f96b676fb6b2bc37",
		"Latitude": 50.451267,
		"Longitude": 30.499932,
		"Level": 5,
		"ETime": 25,
		"Price": 18.55
	},
	{
		"Code": "06aeb199a59f96b5d91cbc7676fb6b2bc379372f",
		"Latitude": 57.465127,
		"Longitude": 28.932499,
		"Level": 4,
		"ETime": 54,
		"Price": 104.00
	},
	...
]
```

### `/orgs/get` `/orgs/set`

Получение расширенной информации об искомой аптеке по ее коду.

```
GET http://example.com/orgs/get?code=value&keysum=value1,value2 HTTP/1.1
```

Результат все доступные данные по аптеке или сети.


```json
{
	"Code": "7676906aeb99fb6b2bc37f96b5d372f91a519cbc",    // Код торговой точки
	"CodeNet": "f96b5d372f91a519cbc7676906aeb99fb6b2bc37", // Код торговой сети
	"Name": "Аптека 8",                                    // Название торговой точки
	"Kind": "Аптека",                                      // Тип торговой точки (Аптека|Аптечный пункт)
	"AddrCountry": "Украина",                              // Страна
	"AddrRegion": "Киевская",                              // Область
	"AddrArea": "Киевский",                                // Район
	"AddrCity": "Киев",                                    // Населенный пункт
	"AddrPost": "01054",                                   // Почтовый индекс
	"AddrStreet": "ул.Воровского, 27",                     // Улица, дом
	"ContactName": "Сидоров Петр Иванович",                // Контактное лицо
	"ContactMail": "mail@example.com",                     // Контактная почта
	"ContactPhone": "(044)4515602",                        // Контактный телефон
	"Latitude": 50.451267,                                 // Координата Широта
	"Longitude": 30.499932,                                // Координата Долгота
	"Phone": "(044)4515602",                               // Телефон(ы)
	"Skype": "apteka-example",                             // Skype ^
	"DescMode": "Пн-С: с 8-00 до 21-00\nВс: выходной",     // Описание режима работы торговой точки FIXME
	"DescPath": "От \"Цирка\" марш. №439 две ост.",        // Описание проезда ^
	"DescDisc": "Скидки владельцам дисконтных карт.",      // Описание дисконтной программы ^
	"TypeDeliver": "самомывоз",                            // Доставка/самовывоз ^
	"TypeBooking": "бронирование",                         // Бронирование/заказ ^
	"DescDelivery": "самомывоз",                           // Описание условий доставки/самовывоза ^
	"DescBooking": "бронирование в течение 2 суток",       // Описание условий бронипрования/заказа ^
	"Active": true                                         // Признак активности аккаунта по Аксиоме
}

```
Сеть.

```json
{
	"Code": "f96b5d372f91a519cbc7676906aeb99fb6b2bc37",  // Код торговой сети
	"Name": "Аптека Example",                            // Наименование сети (торговая марка)
	"NameFull": "Аптека Example",                        // Полное наименование юридического лица
	"NameShort": "А-Example",                            // Краткое наименование юридического лица
	"Description": "\"АПТЕКА EXAMPLE\" - все по 1 грн!", // Описание аптеки/сети 
	"AddrLegalCountry": "Украина",                       // Юридический адрес: Страна
	"AddrLegalRegion": "Киевская",                       // Юридический адрес: Область
	"AddrLegalArea": "Киевский",                         // Юридический адрес: Район
	"AddrLegalCity": "Киев",                             // Юридический адрес: Населенный пункт
	"AddrLegalPost": "01054",                            // Юридический адрес: Почтовый индекс
	"AddrLegalStreet": "ул.Воровского, 27",              // Юридический адрес: Улица, дом
	"AddrPhysicCountry": "Украина",                      // Физический адрес: Страна
	"AddrPhysicRegion": "Киевская",                      // Физический адрес: Область
	"AddrPhysicArea": "Киевский",                        // Физический адрес: Район
	"AddrPhysicCity": "Киев",                            // Физический адрес: Населенный пункт
	"AddrPhysicPost": "01054",                           // Физический адрес: Почтовый индекс
	"AddrPhysicStreet": "ул.Воровского, 27",             // Физический адрес: Улица, дом
	"ContactName": "Сидоров Петр Иванович",              // Контактное лицо
	"ContactMail": "mail@example.com",                   // Контактная почта
	"ContactPhone": "(044)4515602",                      // Контактный телефон
	"Director": "Иван Петрович Сидоров",                 // Директор (ФИО)
	"SiteCorp": "http://apteka-example.com.ua",          // Сайт корпоративный
	"SiteSale": "http://sale.apteka-example.com.ua",     // Сайт продажный
	"License": "АВ №574839",                             // Лицензия номер
	"LicenseStart": "12.08.2013",                        // Лицензия дата начала
	"LicenseFinish": "12.08.2018",                       // Лицензия дата окончания
	"EGRPOU": "95738475",                                // ЕГРПОУ
	"NoACC": "18293834750984",                           // Расчетный счет ^
	"NoMFO": "389576",                                   // МФО ^
	"NoINN": "123456789098",                             // Индивидуальный налоговый номер (ИНН) ^
	"NoREG": "987465738",                                // Номер свидетельства регистрации ^
	"NoVAT": "847563729",                                // Номер свидетельства плательщика НДС ^
	"Active": true                                       // Признак активности аккаунта по Аксиоме
}
```

### `/data/add`


```json
{
	"Meta": {
		"Code": "96b5d372f91a519cbc7676906aeb99fb6b2bc37f", // Код торговой точки
		"Head": "А-Example",                                // Название сети (юр.лица)
		"Name": "Аптека 8",                                 // Название торговой точки
		"Addr": "Киев, Воровского 27",                      // Адрес торговой точки
		"EGRPOU": "95738475",                               // ЕГРПОУ
		"DateTimeZone": "",                                 // Дата/время/временная зона формирования прайса 				
		"Version": 1,                                       // Версия формата
		"Agent": "My Cool Application"                      // Агент передачи данных (программа) ^
	},
	"Data": [{
		"Code": "321654",                                   // Код товара в торговой точке
		"Name": "ГЕПТРАЛ табл.400мг№20 Аббот Швейцария",    // Полное наименование препарата + производитель (через пробел)
		"Desc": "Скидка 6% с 1.03.13 по 31.03.13",          // Описание (акция)
		"Addr": "http://www.add.ua/shop/UID_84054.html",    // Адрес товара на сайте интернет-аптеки
		"Price": 325.00,                                    // Цена розничная
		"Quant": 2.33                                       // Остаток товара в торговой точке		
	}]
}
```