# Формат приемо-передачи данных для PharmXplorer (Draft) #

*документ постоянно обновляется*

Искомый формат предполагает возможность передачи данных о [приходах/расходах/остатках][0] из одной или нескольких точек за определенный временной интервал. Формат обеспечивает требования текущей архитектуры обработки данных. Пары ключ-значение, для которых не существует значения (0 для чисел или пустые строки) могут быть исключены при формировании реальных выходных данных.

Спецификация-пример (1 точка, 1 наименование):

* Формат [JSON](http://json.org/json-ru.html)
* Кодировка [UTF-8](http://ru.wikipedia.org/wiki/UTF-8)
* `/* */` - это комментарий только для пояснения и он должен отсутствовать в реальных данных
* `[*]` - эту пару ключ-значение можно пропустить 
* `string, int, float, bool` - типы данных: “строка в двойных кавычках”, целое, число с плавающей точкой (разделитель точка “.”), логический (true|false)
* [`string[project]`][0]

```json
{
	/* Метаданные */
	"Meta": {
		/* Версия формата, int */
		"Version": 1,
		/* Отправитель (public key), string */
		"Sender": "f96b5d3726906aeb99fb6b2bc37f91a519cbc767",
		/* Агент передачи данных (программа) [*], string */
		"Agent": "My Cool Application",
		/* Проект, для которого формируются данные, string[project] */
		"Project": "sale-out/daily",
		/* Учетность данных [*], string[analytical|synthetic] */
		"Accounting": "analytical",
		/* Остаток на начало или конец периода [*], bool */
		"BalanceStart": false,
		/* Нижняя граница временного диапазона отбора данных, string[dd.mm.yyyy hh:mm:ss] */
		"TimestampLower": "08.10.2012 00:00:00",
		/* Верхняя граница временного диапазона отбора данных, string[dd.mm.yyyy hh:mm:ss] */
		"TimestampUpper": "08.10.2012 23:59:59",

		/* << ==== recognition only ==== */
		/* Связь Морион для отправителя, int */
		"SenderID": 403
		/* ========================== >> */		
	},
	/* Данные (массив заголовок/содержание) */
	"Data": [{
		/* Заголовок */
		"Head": {
			/* Источник данных (BR_NICK), string[20] */
			"Source": "21-00-0540-А",
		},
		/* Содержание (массив записей содержания) */
		"Item": [{
			/* Код препарата клиента, string[40] */
			"Code": "10420",
			/* Name: Полное наименование препарата + производитель (через пробел), string[255] */
			"Name": "Авамис аэр.27,5мкг/доза бал. 30д Глаксо Велком",
			
			/* << ==== sale-in must ==== */
			/* Поставщик, string[1024] */
			"Supplier": "Рога и Копыта Корпорейшн",
			/* ЕГРПОУ (ранее ОКПО), string[12] */
			"EGRPOU": "82389009",
			/* ====================== >> */

			/* << ==== sale-in must, sale-out maybe ==== */
			/* Приход количество, float */
			"InQuant": 20,
			/* Приход цена (за единицу товара, float */
			"InPrice": 32.50,
			/* ====================================== >> */
			
			/* << ==== sale-out must ==== */
			/* Расход количество, float */
			"OutQuant": 3,
			/* Расход цена (за единицу товара), float */
			"OutPrice": 39.72,
			/* ======================= >> */

			/* << ==== sale-in maybe, sale-out maybe ==== */
			/* Остаток на конец периода, float */
			"Balance": 8,
			/* ======================================= >> */

			/* << ==== recognition only ==== */
			/* Связь Морион для наименования */
			"LinkName": "FIXME",
			/* Связь Морион для поставщика */
			"LinkSupp": "FIXME"
			/* ========================== >> */
		}]
	}]
}
```

[0]: https://github.com/pharmbase/rfc/blob/master/src/api-proj.md
